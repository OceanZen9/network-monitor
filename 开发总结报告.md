# 分布式主机监控系统 - 开发总结报告

## 1. 开发目的 (Development Purpose)

本项目（课题四：分布式主机监控系统）的主要开发目的是设计并实现一个能够对局域网内多台主机进行远程监控的系统。具体的实验要求和目标包括：

1.  **掌握分布式网络编程技术**：通过实现服务器与客户端之间的通信，理解并应用 Socket 编程（本项目中使用 WebSocket/SocketIO 技术作为现代化的替代方案）。
2.  **实现主机状态监控**：能够实时监控并显示被控端主机的关键事件，具体包括：
    *   系统启动 (System Start)
    *   系统关机 (System Stop)
    *   IE 浏览器启动 (IE Start)
    *   IE 浏览器关闭 (IE Close)
3.  **XML 数据存储与管理**：不依赖传统关系型数据库（如 MySQL），而是通过 XML 文件来存储和维护受控主机的基础配信息（如 ID、主机名、IP 地址、描述等），以练习文件极其数据格式的处理。
4.  **Web 可视化展示**：构建 Web 界面，直观地展示主机列表及其当前的实时状态（在线/离线、应用运行状态），并提供管理功能。

## 2. 开发过程 (Development Process)

本次开发基于现有的网络监控平台（Flask + React）进行扩展，主要经历了以下几个阶段：

### 2.1 需求分析与技术选型
*   **通信协议**：考虑到实时性要求，选择 **Socket.IO** 替代传统的原始 Socket，以便更好地与 Web 前端集成。
*   **数据存储**：严格按照要求，新建 `backend/clients.xml` 文件作为数据源，并开发 Python 工具类处理 XML 的增删改查。
*   **客户端模拟**：为了方便测试和演示，开发了一个 Python 脚本 `agent.py` 来模拟分布式的客户端主机，发送状态指令。

### 2.2 后端开发 (Backend)
1.  **XML 管理模块**：实现了 `XMLManager` 类 (`backend/utils/xml_manager.py`)，利用 Python 的 `xml.etree.ElementTree` 库对 `clients.xml` 进行解析和写入，实现了对主机信息的“增删改查”操作。
2.  **主机管理 API**：创建了 Flask Blueprint `client_bp` (`backend/routes/client_management.py`)，开放 RESTful 接口供前端调用，用于管理主机配置。
3.  **实时监控逻辑**：在 `backend/routes/monitoring.py` 中增强了 SocketIO 事件处理。
    *   新增 `client_event` 监听器：接收来自 `agent.py` 的事件。
    *   实现消息转发：收到事件后，立即通过 WebSocket 向前端广播 `alert` (告警) 和 `host_status` (状态更新) 消息。
4.  **端口调整**：解决 macOS 上 5000 端口被 AirPlay 占用的冲突，将服务端口迁移至 **5001**。

### 2.3 前端开发 (Frontend)
1.  **主机管理页面**：新增 `ClientManagement.tsx` 页面，使用 Ant Design 表格和表单组件，实现了对 XML 中主机数据的可视化管理（添加、编辑、删除）。
2.  **实时状态面板**：开发 `HostStatusPanel.tsx` 组件并集成到仪表盘 (Dashboard)。该组件订阅后端的 `host_status` 事件，实时根据收到的信号改变对应主机的状态卡片样式（如系统开启亮灯、IE 运行标签等）。
3.  **API 适配**：更新 `api.ts` 和 `socketStore.ts`，确保前端请求指向新的 5001 端口，并修复了部分 TypeScript 类型错误。

### 2.4 联调与测试
*   编写 `agent.py` 脚本，通过命令行交互的方式，模拟不同 ID 的主机发送“开机”、“关机”等指令。
*   解决了路由配置中的前缀重复问题（`404 Not Found`），确保 API 畅通。
*   验证了 XML 文件的读写正确性，确认重启服务器后数据依然保留。

## 3. 开发结果 (Development Results)

经过开发与调试，系统已具备以下功能：

1.  **主机信息管理**：
    *   用户可以在 Web 界面上添加、修改、删除主机信息。
    *   所有数据持久化存储在服务器端的 `clients.xml` 文件中，符合实验要求。

2.  **实时状态监控**：
    *   **Agent 模拟器**：通过运行 `python agent.py`，用户可以模拟指定 ID 主机的行为。
    *   **实时响应**：当 Agent 发送“系统启动”或“IE 启动”信号时，Web 仪表盘上的对应主机卡片会立即更新状态（无需刷新页面）。
    *   **告警通知**：系统会即时弹出通知提示用户的操作事件。

3.  **技术指标达成**：
    *   成功整合了 HTTP (REST API) 和 WebSocket (Socket.IO) 通信。
    *   成功实现了基于 XML 的轻量级数据存储方案。
    *   解决了环境配置和端口冲突问题，系统运行稳定。

### 总结
本项目成功在现有的网络监控平台基础上，通过“魔改”扩展了分布式主机监控功能。不仅实现了核心的监控业务逻辑，还保证了前后端交互的实时性和用户体验的流畅性，圆满达成了课题四的各项开发目标。
